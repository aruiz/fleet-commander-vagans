
playbook: ansible/fleet-commander-playbook.yml

  play #1 (all): safe-guard against race condition	TAGS: []
    tasks:
      wait for the node to be ready	TAGS: [bootstrap]

  play #2 (all): install IPA base system	TAGS: []
    tasks:
      bootstrap : Check default route	TAGS: [bootstrap]
      bootstrap : Create some default route	TAGS: [bootstrap]
      bootstrap : Check for dnf command	TAGS: [bootstrap, package-install]
      bootstrap : Auto select fastest DNF mirror	TAGS: [bootstrap, package-install]
      bootstrap : Refresh dnf cache	TAGS: [bootstrap, network, package-install]
      bootstrap : Install python2 and deps for ansible modules	TAGS: [bootstrap, network, package-install]
      bootstrap : Gather facts	TAGS: [bootstrap]
      bootstrap : Create directories in ipa_data_dir	TAGS: [bootstrap]
      bootstrap : Dummy (for ansible.skip_tags)	TAGS: [dummy]
      common : DNF or YUM?	TAGS: [common]
      common : Default facts (enable_packages, enable_network)	TAGS: [common]
      common : Override enable_packages=true	TAGS: [common, package-install]
      common : Override enable_network=true	TAGS: [common, network]
      common : Get nmcli device info	TAGS: [common]
      common : Set nmcli device info fact	TAGS: [common]
      common : fix /etc/hosts	TAGS: [common]
      common : Set FQDN hostname	TAGS: [common]
      common : Get timedatectl information	TAGS: [common]
      common : Set timezone to UTC	TAGS: [common]
      common : Disable dnf repos to prevent network access	TAGS: [common]
      common : Enable dnf repos	TAGS: [common]
      common : Auto select fastest DNF mirror	TAGS: [common, package-install]
      common : Enable yum for Fedora	TAGS: [common, network, package-install]
      common : Disable yum repos to prevent network access	TAGS: [common]
      common : Enable yum repos	TAGS: [common]
      common : Auto-select fastest yum mirror	TAGS: [common, network, package-install]
      common : Install gpg command for COPR / rpm_key	TAGS: [common, network, package-copr, package-install]
      common : Add GPG RPM keys for copr	TAGS: [common, network, package-copr, package-install]
      common : Enable extra COPRs	TAGS: [common, network, package-copr, package-install]
      common : upgrade all packages	TAGS: [common, network, package-install, package-upgrade]
      common : Create directory for custom RPMS	TAGS: [common, custom-rpms]
      common : Install rsync	TAGS: [common, custom-rpms, network, package-install]
      common : Synchronize RPMs	TAGS: [common, custom-rpms]
      common : find custom RPMs	TAGS: [common, custom-rpms]
      common : install custom RPMs	TAGS: [common, custom-rpms]
      common : install selinux tools	TAGS: [common, network, package-install]
      common : disable selinux for 389-DS installation	TAGS: [common, lxc]
      common : install firewalld	TAGS: [firewall, network, package-install, pki]
      common : check for firewalld	TAGS: [common, firewall]
      common : Enable and start firewalld	TAGS: [common, firewall]
      common : Open firewall ports elemental services	TAGS: [common, firewall]
      common : Install rng tools	TAGS: [common, network, package-install]
      common : Start the rngd service	TAGS: [common]
      common : tty-less sudo	TAGS: [common]
      ipa : make a copy of original resolv.conf	TAGS: [ipa]
      ipa : Get default DNS	TAGS: [ipa]
      ipa : Get reverse zone	TAGS: [ipa]
      ipa : Remove chrony (FreeIPA uses ntpd)	TAGS: [ipa, package-install]
      ipa : install FreeIPA client package (Fedora)	TAGS: [ipa, network, package-install]
      ipa : install FreeIPA client package (RHEL / CentOS)	TAGS: [ipa, network, package-install]
      ipa : Check for mod_ssl configuration	TAGS: [ipa]
      ipa : Disable mod_ssl configuration	TAGS: [ipa]
      ipa : Gather IPA facts	TAGS: [ipa]

  play #3 (ipaserver_master,ipaserver_replica): install IPA server system	TAGS: []
    tasks:
      ipaserver : install FreeIPA server package (Fedora)	TAGS: [ipaserver, network, package-install]
      ipaserver : install FreeIPA server package (RHEL / CentOS)	TAGS: [ipaserver, network, package-install]
      ipaserver : Open Firewall for services	TAGS: [firewall, ipaserver]

  play #4 (ipaserver_master): install FreeIPA server master	TAGS: []
    tasks:
      ipaserver-master : Install FreeIPA master (5-7 minutes)	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Install KRA on FreeIPA master (2-3 minutes)	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Update IPA facts	TAGS: [ipaserver-master]
      ipaserver-master : Make sure named-pkcs11 DNS is restarted	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : wait for services to come up	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Set ipv4_dns fact	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Add replica to ipv4_dns fact	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Use FreeIPA DNS, nmcli conn modify ipv4.dns	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Use FreeIPA DNS, nmcli conn modify ipv4.dns-search	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Use FreeIPA DNS, nmcli conn modify ipv4.ignore-auto-dns	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Restart NetworkManager to make DNS changes effective	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Set sensible defaults	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Enable password and OTP loging	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Enable global DNS sync ptr	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Enable DNS sync ptr	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Enable reverse DNS sync ptr	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : signal FreeIPA master has been deployed	TAGS: [ipa-install, ipaserver-master]
      ipaserver-master : Fetch IPA ca.crt	TAGS: [fetch, ipa-install, ipaserver-master]
      ipaserver-master : Copy IPA ca.crt to all machines	TAGS: [ipa-install, ipaserver-master]

  play #5 (ipaserver_master): create local inventory files	TAGS: []
    tasks:
      ipa-inventory : Create Firefox prefs	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Create Firefox bookmarks	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Fetch Firefox files	TAGS: [fetch, ipa-install, ipa-inventory]
      ipa-inventory : Copy local Firefox files	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Write custom krb5.conf	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Write custom krb5.conf for MS-KKDCP	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Fetch resolv.conf	TAGS: [fetch, ipa-install, ipa-inventory]
      ipa-inventory : Fetch IPA ca.crt	TAGS: [fetch, ipa-install, ipa-inventory]
      ipa-inventory : Fetch ipa default.conf	TAGS: [fetch, ipa-install, ipa-inventory]
      ipa-inventory : Fetch kra agent pem file	TAGS: [fetch, ipa-install, ipa-inventory]
      ipa-inventory : Template local scripts	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Template local inventory files	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Check for NSSDB	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Create NSSDB directory	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Create NSSDB	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Remove old CA.crt from NSSDB	TAGS: [ipa-install, ipa-inventory]
      ipa-inventory : Populate NSSDB with CA.crt	TAGS: [ipa-install, ipa-inventory]

  play #6 (ipaserver_replica): install FreeIPA server replica	TAGS: []
    tasks:
      ipaserver-replica : join FreeIPA	TAGS: [ipa-client, ipa-install]
      ipaserver-replica : Update IPA facts	TAGS: [ipa-client]
      ipaserver-replica : install replica	TAGS: [ipa-install, ipaserver-replica]
      ipaserver-replica : Prepare replication	TAGS: [ipa-install, ipaserver-replica]
      ipaserver-replica : Fetch replication file	TAGS: [fetch, ipa-install, ipaserver-replica]
      ipaserver-replica : Copy replication file	TAGS: [ipa-install, ipaserver-replica]
      ipaserver-replica : install replica	TAGS: [ipa-install, ipaserver-replica]
      ipaserver-replica : Update IPA facts	TAGS: [ipaserver-replica]
      ipaserver-replica : Install CA on FreeIPA replica (3-4 minutes)	TAGS: [ipa-install, ipaserver-replica]
      ipaserver-replica : Install KRA on FreeIPA replica (2-3 minutes)	TAGS: [ipa-install, ipaserver-replica]
      ipaserver-replica : Make sure named-pkcs11 DNS is restarted	TAGS: [ipa-install, ipaserver-replica]
      ipaserver-replica : Update IPA facts	TAGS: [ipaserver-replica]

  play #7 (ipa_client): install FreeIPA client	TAGS: []
    tasks:
      ipa-client : join FreeIPA	TAGS: [ipa-client, ipa-install]
      ipa-client : Update IPA facts	TAGS: [ipa-client]
